# Live Grading Assistant

## Manual Transcript Callback

The app exposes a serverless webhook that allows ADEN, n8n, or other services to push manual transcript results directly into an active grading session.

### POST `https://<your-vercel-domain>/api/manual-transcript-callback`
- **Headers**
  - `Content-Type: application/json`
  - Optional `X-Shared-Secret: <secret>` (required when `MANUAL_TRANSCRIPT_SECRET` is configured)
- **Body**
  - Must include the `sessionId` generated by the web UI when grading begins.
  - The remainder of the payload should match any of the result shapes already supported by `normalizeWebhookResult` (array of students, `{ students: [...] }`, `{ data: [...] }`, or a single student object).

Example:
```json
{
  "sessionId": "1731268923456",
  "students": [
    {
      "studentId": "rec123",
      "studentName": "Ava Lee",
      "scores": { "Correctness": 23, "Method": 22, "Clarity": 24, "Completeness": 21 },
      "comments": "Great reasoning; tighten notation."
    }
  ]
}
```

A successful request returns `200 { "ok": true }`.

### GET `https://<your-vercel-domain>/api/manual-transcript-callback?sessionId=<id>`
- Polls for queued transcript results for the given session.
- Responds with `{ "data": [ /* payloads you POSTed */ ] }` and clears the queue.

Use this endpoint when running locally as well; if Upstash credentials are not present the queue falls back to an in-memory store.

### Authentication
Configure `MANUAL_TRANSCRIPT_SECRET` to require callers to send `X-Shared-Secret`. Requests without the correct secret will receive `401`.

### Environment Variables
- `UPSTASH_REDIS_REST_URL`
- `UPSTASH_REDIS_REST_TOKEN`
- `MANUAL_TRANSCRIPT_SECRET` (optional)

These values power the shared KV queue used for manual transcript callbacks.
